<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0a0a0a">
<meta name="description" content="Calorie & Macro Tracker">
<link rel="manifest" href="manifest.json">
<title>610 â€” Calorie Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #080808;
    --dark: #111111;
    --card: #161616;
    --border: rgba(255,255,255,0.07);
    --amber: #C9943A;
    --amber-light: #E8B96A;
    --amber-dim: rgba(201,148,58,0.15);
    --white: #F5F0E8;
    --muted: rgba(245,240,232,0.45);
    --danger: #C0392B;
    --success: #27AE60;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--black);
    color: var(--white);
    font-family: 'DM Sans', sans-serif;
    font-weight: 300;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ NOISE OVERLAY â”€â”€ */
  body::before {
    content:'';
    position:fixed;
    inset:0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.035'/%3E%3C/svg%3E");
    pointer-events:none;
    z-index:9999;
    opacity:0.6;
  }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen {
    display:none;
    min-height:100vh;
    animation: fadeUp 0.6s ease forwards;
  }
  .screen.active { display:flex; }

  @keyframes fadeUp {
    from { opacity:0; transform:translateY(24px); }
    to   { opacity:1; transform:translateY(0); }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANDING SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #landing {
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
    padding:2rem;
    position:relative;
    overflow:hidden;
  }

  #landing .glow {
    position:absolute;
    width:600px; height:600px;
    background: radial-gradient(circle, rgba(201,148,58,0.12) 0%, transparent 70%);
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    pointer-events:none;
  }

  .brand-line {
    font-size:0.65rem;
    letter-spacing:0.35em;
    color:var(--amber);
    text-transform:uppercase;
    margin-bottom:1.5rem;
  }

  .hero-title {
    font-family:'Cormorant Garamond', serif;
    font-size:clamp(3.5rem, 10vw, 6.5rem);
    font-weight:300;
    line-height:0.95;
    letter-spacing:-0.01em;
    margin-bottom:1.5rem;
  }
  .hero-title em {
    font-style:italic;
    color:var(--amber-light);
  }

  .hero-sub {
    font-size:0.9rem;
    color:var(--muted);
    letter-spacing:0.05em;
    margin-bottom:3.5rem;
    max-width:320px;
  }

  .btn-primary {
    background: var(--amber);
    color: #000;
    border:none;
    padding:0.85rem 2.5rem;
    font-family:'DM Sans', sans-serif;
    font-size:0.8rem;
    font-weight:500;
    letter-spacing:0.12em;
    text-transform:uppercase;
    cursor:pointer;
    transition: all 0.3s ease;
    position:relative;
    overflow:hidden;
  }
  .btn-primary::after {
    content:'';
    position:absolute;
    inset:0;
    background:rgba(255,255,255,0.15);
    opacity:0;
    transition:opacity 0.3s;
  }
  .btn-primary:hover::after { opacity:1; }
  .btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 32px rgba(201,148,58,0.35); }
  .btn-primary:active { transform:translateY(0); }

  .landing-footer {
    position:absolute;
    bottom:2rem;
    font-size:0.7rem;
    color:var(--muted);
    letter-spacing:0.1em;
  }

  /* Decorative lines */
  .deco-line {
    width:1px;
    height:80px;
    background: linear-gradient(to bottom, transparent, var(--amber), transparent);
    margin: 0 auto 2rem;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUTH SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #auth {
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:2rem;
  }

  .auth-card {
    width:100%;
    max-width:400px;
    background:var(--card);
    border:1px solid var(--border);
    padding:2.5rem;
    position:relative;
  }
  .auth-card::before {
    content:'';
    position:absolute;
    top:0; left:0; right:0;
    height:1px;
    background: linear-gradient(90deg, transparent, var(--amber), transparent);
  }

  .auth-toggle {
    display:flex;
    margin-bottom:2rem;
    border-bottom:1px solid var(--border);
  }
  .auth-toggle button {
    flex:1;
    background:none;
    border:none;
    color:var(--muted);
    font-family:'DM Sans', sans-serif;
    font-size:0.8rem;
    letter-spacing:0.1em;
    text-transform:uppercase;
    padding:0.75rem;
    cursor:pointer;
    transition:all 0.3s;
    position:relative;
  }
  .auth-toggle button.active {
    color:var(--amber);
  }
  .auth-toggle button.active::after {
    content:'';
    position:absolute;
    bottom:-1px; left:0; right:0;
    height:1px;
    background:var(--amber);
  }

  .auth-title {
    font-family:'Cormorant Garamond', serif;
    font-size:1.8rem;
    font-weight:300;
    margin-bottom:0.5rem;
  }
  .auth-sub {
    font-size:0.78rem;
    color:var(--muted);
    margin-bottom:2rem;
  }

  .field {
    margin-bottom:1.25rem;
  }
  .field label {
    display:block;
    font-size:0.7rem;
    letter-spacing:0.12em;
    text-transform:uppercase;
    color:var(--muted);
    margin-bottom:0.5rem;
  }
  .field input {
    width:100%;
    background:rgba(255,255,255,0.03);
    border:1px solid var(--border);
    color:var(--white);
    font-family:'DM Sans', sans-serif;
    font-size:0.9rem;
    padding:0.75rem 1rem;
    outline:none;
    transition:border-color 0.3s;
  }
  .field input:focus {
    border-color:var(--amber);
    background:var(--amber-dim);
  }
  .field input::placeholder { color:rgba(245,240,232,0.2); }

  .auth-error {
    color:var(--danger);
    font-size:0.78rem;
    margin-bottom:1rem;
    display:none;
  }
  .auth-error.show { display:block; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #app {
    flex-direction:column;
    min-height:100vh;
  }

  /* Header */
  .app-header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:1.25rem 1.5rem;
    border-bottom:1px solid var(--border);
    background:var(--dark);
    position:sticky; top:0; z-index:100;
  }
  .app-header .logo {
    font-family:'Cormorant Garamond', serif;
    font-size:1.3rem;
    font-weight:300;
    color:var(--amber-light);
    letter-spacing:0.05em;
  }
  .header-right {
    display:flex;
    align-items:center;
    gap:1rem;
  }
  .user-greeting {
    font-size:0.75rem;
    color:var(--muted);
    letter-spacing:0.05em;
  }
  .btn-logout {
    background:none;
    border:1px solid var(--border);
    color:var(--muted);
    font-size:0.7rem;
    letter-spacing:0.1em;
    text-transform:uppercase;
    padding:0.4rem 0.9rem;
    cursor:pointer;
    transition:all 0.3s;
  }
  .btn-logout:hover { border-color:var(--amber); color:var(--amber); }

  /* Main content */
  .app-main {
    flex:1;
    padding:1.5rem;
    max-width:500px;
    margin:0 auto;
    width:100%;
  }

  /* Date bar */
  .date-bar {
    display:flex;
    align-items:baseline;
    justify-content:space-between;
    margin-bottom:1.75rem;
  }
  .date-label {
    font-family:'Cormorant Garamond', serif;
    font-size:1.5rem;
    font-weight:300;
    font-style:italic;
    color:var(--white);
  }
  .date-sub {
    font-size:0.72rem;
    color:var(--muted);
    letter-spacing:0.08em;
  }

  /* Calorie ring card */
  .calorie-card {
    background:var(--card);
    border:1px solid var(--border);
    padding:2rem 1.5rem;
    margin-bottom:1.25rem;
    position:relative;
    overflow:hidden;
  }
  .calorie-card::before {
    content:'';
    position:absolute;
    top:0; left:0; right:0;
    height:1px;
    background:linear-gradient(90deg, transparent, var(--amber), transparent);
  }

  .calorie-summary {
    display:flex;
    align-items:center;
    gap:2rem;
  }

  .ring-wrap {
    position:relative;
    flex-shrink:0;
  }
  .ring-wrap svg { transform:rotate(-90deg); }
  .ring-bg { fill:none; stroke:rgba(255,255,255,0.06); stroke-width:8; }
  .ring-fill {
    fill:none;
    stroke:var(--amber);
    stroke-width:8;
    stroke-linecap:round;
    transition: stroke-dashoffset 1s cubic-bezier(0.4,0,0.2,1);
  }
  .ring-center {
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
  }
  .ring-cal {
    font-family:'Cormorant Garamond', serif;
    font-size:1.8rem;
    font-weight:300;
    line-height:1;
  }
  .ring-label {
    font-size:0.6rem;
    letter-spacing:0.12em;
    text-transform:uppercase;
    color:var(--muted);
    margin-top:0.2rem;
  }

  .calorie-stats {
    flex:1;
  }
  .stat-row {
    display:flex;
    justify-content:space-between;
    align-items:baseline;
    padding:0.4rem 0;
    border-bottom:1px solid var(--border);
  }
  .stat-row:last-child { border-bottom:none; }
  .stat-name {
    font-size:0.72rem;
    letter-spacing:0.08em;
    color:var(--muted);
    text-transform:uppercase;
  }
  .stat-val {
    font-family:'Cormorant Garamond', serif;
    font-size:1.1rem;
    font-weight:300;
  }
  .stat-val.amber { color:var(--amber-light); }
  .stat-val.green { color:#6FCF97; }
  .stat-val.red   { color:#EB5757; }

  /* Macro pie card */
  .macro-card {
    background:var(--card);
    border:1px solid var(--border);
    padding:1.5rem;
    margin-bottom:1.25rem;
  }

  .section-label {
    font-size:0.65rem;
    letter-spacing:0.2em;
    text-transform:uppercase;
    color:var(--amber);
    margin-bottom:1.25rem;
    display:flex;
    align-items:center;
    gap:0.75rem;
  }
  .section-label::after {
    content:'';
    flex:1;
    height:1px;
    background:var(--border);
  }

  .macro-layout {
    display:flex;
    align-items:center;
    gap:1.5rem;
  }

  #macroPie {
    flex-shrink:0;
  }

  .macro-legend {
    flex:1;
    display:flex;
    flex-direction:column;
    gap:0.6rem;
  }
  .legend-item {
    display:flex;
    align-items:center;
    gap:0.6rem;
  }
  .legend-dot {
    width:8px; height:8px;
    border-radius:50%;
    flex-shrink:0;
  }
  .legend-info { flex:1; }
  .legend-name {
    font-size:0.72rem;
    letter-spacing:0.06em;
    color:var(--muted);
    text-transform:uppercase;
  }
  .legend-val {
    font-family:'Cormorant Garamond', serif;
    font-size:1rem;
    font-weight:300;
  }

  /* Log button */
  .log-section {
    margin-bottom:1.5rem;
  }

  .btn-log {
    width:100%;
    background:none;
    border:1px solid var(--amber);
    color:var(--amber);
    font-family:'DM Sans', sans-serif;
    font-size:0.78rem;
    letter-spacing:0.15em;
    text-transform:uppercase;
    padding:1.1rem;
    cursor:pointer;
    transition:all 0.3s;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:0.75rem;
  }
  .btn-log:hover {
    background:var(--amber-dim);
    box-shadow:0 4px 24px rgba(201,148,58,0.2);
    transform:translateY(-1px);
  }
  .btn-log svg { width:18px; height:18px; }

  /* Food log list */
  .log-list {
    display:flex;
    flex-direction:column;
    gap:0.75rem;
  }

  .log-entry {
    background:var(--card);
    border:1px solid var(--border);
    padding:1rem 1.25rem;
    display:flex;
    align-items:center;
    justify-content:space-between;
    animation: fadeUp 0.4s ease forwards;
    position:relative;
    overflow:hidden;
  }
  .log-entry::before {
    content:'';
    position:absolute;
    left:0; top:0; bottom:0;
    width:2px;
    background:var(--amber);
  }
  .log-entry-info {}
  .log-entry-name {
    font-size:0.88rem;
    font-weight:400;
    margin-bottom:0.2rem;
  }
  .log-entry-time {
    font-size:0.68rem;
    color:var(--muted);
    letter-spacing:0.05em;
  }
  .log-entry-cals {
    font-family:'Cormorant Garamond', serif;
    font-size:1.3rem;
    font-weight:300;
    color:var(--amber-light);
  }
  .btn-del {
    background:none;
    border:none;
    color:rgba(255,255,255,0.15);
    cursor:pointer;
    padding:0.25rem;
    margin-left:0.75rem;
    transition:color 0.2s;
    font-size:1rem;
  }
  .btn-del:hover { color:var(--danger); }

  .empty-log {
    text-align:center;
    padding:2.5rem 1rem;
    color:var(--muted);
    font-size:0.8rem;
    letter-spacing:0.05em;
    border:1px dashed var(--border);
  }
  .empty-log .empty-icon {
    font-size:2rem;
    margin-bottom:0.75rem;
    opacity:0.3;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL (Photo Capture & Analysis)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .modal-overlay {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    z-index:1000;
    align-items:flex-end;
    justify-content:center;
    backdrop-filter:blur(4px);
  }
  .modal-overlay.open {
    display:flex;
    animation:fadeIn 0.3s ease;
  }
  @keyframes fadeIn { from{opacity:0} to{opacity:1} }

  .modal {
    background:var(--dark);
    border:1px solid var(--border);
    border-bottom:none;
    padding:2rem;
    width:100%;
    max-width:500px;
    position:relative;
    animation:slideUp 0.4s cubic-bezier(0.34,1.56,0.64,1) forwards;
  }
  @keyframes slideUp {
    from{transform:translateY(100%)}
    to{transform:translateY(0)}
  }
  .modal::before {
    content:'';
    position:absolute;
    top:0; left:0; right:0;
    height:1px;
    background:linear-gradient(90deg, transparent, var(--amber), transparent);
  }

  .modal-title {
    font-family:'Cormorant Garamond', serif;
    font-size:1.5rem;
    font-weight:300;
    margin-bottom:0.5rem;
  }
  .modal-sub {
    font-size:0.78rem;
    color:var(--muted);
    margin-bottom:1.75rem;
  }

  .photo-zone {
    border:1px dashed rgba(201,148,58,0.3);
    background:rgba(201,148,58,0.03);
    min-height:200px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.3s;
    margin-bottom:1.25rem;
    position:relative;
    overflow:hidden;
  }
  .photo-zone:hover {
    border-color:var(--amber);
    background:var(--amber-dim);
  }
  .photo-zone img {
    width:100%; height:100%;
    object-fit:cover;
    position:absolute;
    inset:0;
  }
  .photo-zone-text {
    text-align:center;
    z-index:1;
  }
  .photo-zone-icon { font-size:2.5rem; margin-bottom:0.5rem; opacity:0.5; }
  .photo-zone-label {
    font-size:0.78rem;
    color:var(--muted);
    letter-spacing:0.08em;
  }

  #fileInput { display:none; }

  /* Analysis result */
  .analysis-result {
    background:var(--amber-dim);
    border:1px solid rgba(201,148,58,0.25);
    padding:1.25rem;
    margin-bottom:1.25rem;
    display:none;
  }
  .analysis-result.show { display:block; }
  .analysis-food-name {
    font-family:'Cormorant Garamond', serif;
    font-size:1.3rem;
    font-weight:300;
    margin-bottom:0.75rem;
  }
  .analysis-macros {
    display:grid;
    grid-template-columns:repeat(4, 1fr);
    gap:0.5rem;
  }
  .am-item { text-align:center; }
  .am-val {
    font-family:'Cormorant Garamond', serif;
    font-size:1.2rem;
    font-weight:300;
    color:var(--amber-light);
  }
  .am-label {
    font-size:0.6rem;
    letter-spacing:0.1em;
    text-transform:uppercase;
    color:var(--muted);
  }

  /* Loading state */
  .analyzing {
    display:none;
    text-align:center;
    padding:1.5rem;
  }
  .analyzing.show { display:block; }
  .spinner {
    width:32px; height:32px;
    border:2px solid var(--border);
    border-top-color:var(--amber);
    border-radius:50%;
    animation:spin 0.8s linear infinite;
    margin:0 auto 1rem;
  }
  @keyframes spin { to{transform:rotate(360deg)} }
  .analyzing-text {
    font-size:0.78rem;
    color:var(--muted);
    letter-spacing:0.1em;
    text-transform:uppercase;
  }
  .analyzing-dots::after {
    content:'...';
    animation:dots 1.5s steps(3,end) infinite;
  }
  @keyframes dots {
    0%{content:'.'}
    33%{content:'..'}
    66%{content:'...'}
  }

  .modal-actions {
    display:flex;
    gap:0.75rem;
  }
  .btn-cancel {
    flex:1;
    background:none;
    border:1px solid var(--border);
    color:var(--muted);
    font-family:'DM Sans', sans-serif;
    font-size:0.78rem;
    letter-spacing:0.1em;
    text-transform:uppercase;
    padding:0.85rem;
    cursor:pointer;
    transition:all 0.3s;
  }
  .btn-cancel:hover { border-color:rgba(255,255,255,0.2); color:var(--white); }

  .btn-save {
    flex:2;
    background:var(--amber);
    border:none;
    color:#000;
    font-family:'DM Sans', sans-serif;
    font-size:0.78rem;
    font-weight:500;
    letter-spacing:0.1em;
    text-transform:uppercase;
    padding:0.85rem;
    cursor:pointer;
    transition:all 0.3s;
    display:none;
  }
  .btn-save.show { display:block; }
  .btn-save:hover { opacity:0.85; }

  /* Toast */
  .toast {
    position:fixed;
    bottom:2rem;
    left:50%;
    transform:translateX(-50%) translateY(100px);
    background:var(--card);
    border:1px solid var(--amber);
    color:var(--amber-light);
    font-size:0.78rem;
    letter-spacing:0.08em;
    padding:0.75rem 1.5rem;
    z-index:9000;
    transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
    white-space:nowrap;
  }
  .toast.show { transform:translateX(-50%) translateY(0); }

  /* Responsive */
  @media(max-width:360px) {
    .calorie-summary { flex-direction:column; }
    .macro-layout { flex-direction:column; }
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANDING SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="landing">
  <div class="glow"></div>
  <div class="brand-line">610 Nutrition</div>
  <div class="deco-line"></div>
  <h1 class="hero-title">Calorie<br><em>Tracker</em></h1>
  <p class="hero-sub">Effortless awareness.<br>Track every meal with precision.</p>
  <button class="btn-primary" onclick="showAuth()">Begin Your Journey</button>
  <div class="landing-footer">Powered by AI Vision</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUTH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="auth" style="flex-direction:column;align-items:center;justify-content:center;padding:2rem;">
  <div class="auth-card">
    <div class="auth-toggle">
      <button id="tabLogin" class="active" onclick="switchTab('login')">Sign In</button>
      <button id="tabRegister" onclick="switchTab('register')">Create Account</button>
    </div>

    <h2 class="auth-title" id="authTitle">Welcome back</h2>
    <p class="auth-sub" id="authSub">Sign in to continue your journey</p>

    <div class="auth-error" id="authError"></div>

    <div class="field" id="nameField" style="display:none;">
      <label>Your Name</label>
      <input type="text" id="inputName" placeholder="e.g. Alex">
    </div>
    <div class="field">
      <label>Username</label>
      <input type="text" id="inputUser" placeholder="username" autocomplete="username">
    </div>
    <div class="field">
      <label>Password</label>
      <input type="password" id="inputPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
    </div>
    <div class="field" id="goalField" style="display:none;">
      <label>Daily Calorie Goal</label>
      <input type="number" id="inputGoal" placeholder="e.g. 2600" value="2600">
    </div>

    <button class="btn-primary" style="width:100%" onclick="handleAuth()">Continue</button>
    <p style="margin-top:1.25rem;text-align:center;font-size:0.72rem;color:var(--muted)">
      <span id="switchText">Don't have an account?</span>
      <a href="#" onclick="switchTab(currentTab==='login'?'register':'login');return false;"
         style="color:var(--amber);text-decoration:none;margin-left:0.3rem" id="switchLink">Create one</a>
    </p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="app" style="flex-direction:column;">
  <header class="app-header">
    <div class="logo">610</div>
    <div class="header-right">
      <span class="user-greeting" id="greetingText"></span>
      <button class="btn-logout" onclick="logout()">Sign Out</button>
    </div>
  </header>

  <main class="app-main">
    <div class="date-bar">
      <div class="date-label" id="dateLabel"></div>
      <div class="date-sub" id="dateGoalLabel"></div>
    </div>

    <!-- Calorie Ring -->
    <div class="calorie-card">
      <div class="calorie-summary">
        <div class="ring-wrap">
          <svg width="110" height="110" viewBox="0 0 110 110">
            <circle class="ring-bg" cx="55" cy="55" r="46"/>
            <circle class="ring-fill" id="ringFill" cx="55" cy="55" r="46"
              stroke-dasharray="289"
              stroke-dashoffset="289"/>
          </svg>
          <div class="ring-center">
            <div class="ring-cal" id="ringCalNum">0</div>
            <div class="ring-label">consumed</div>
          </div>
        </div>
        <div class="calorie-stats">
          <div class="stat-row">
            <span class="stat-name">Goal</span>
            <span class="stat-val amber" id="statGoal">2,600</span>
          </div>
          <div class="stat-row">
            <span class="stat-name">Consumed</span>
            <span class="stat-val" id="statConsumed">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-name">Remaining</span>
            <span class="stat-val green" id="statRemaining">2,600</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Macro Pie -->
    <div class="macro-card">
      <div class="section-label">Macronutrients</div>
      <div class="macro-layout">
        <canvas id="macroPie" width="120" height="120"></canvas>
        <div class="macro-legend">
          <div class="legend-item">
            <div class="legend-dot" style="background:#C9943A"></div>
            <div class="legend-info">
              <div class="legend-name">Protein</div>
              <div class="legend-val" id="macroProtein">0g</div>
            </div>
          </div>
          <div class="legend-item">
            <div class="legend-dot" style="background:#6FCF97"></div>
            <div class="legend-info">
              <div class="legend-name">Carbs</div>
              <div class="legend-val" id="macroCarbs">0g</div>
            </div>
          </div>
          <div class="legend-item">
            <div class="legend-dot" style="background:#EB5757"></div>
            <div class="legend-info">
              <div class="legend-name">Fat</div>
              <div class="legend-val" id="macroFat">0g</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Log Button -->
    <div class="log-section">
      <button class="btn-log" onclick="openModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/>
        </svg>
        Log a Meal
      </button>
    </div>

    <!-- Food Log -->
    <div class="section-label">Today's Log</div>
    <div class="log-list" id="logList">
      <div class="empty-log">
        <div class="empty-icon">ğŸ½</div>
        <div>No meals logged today.<br>Tap <em>Log a Meal</em> to get started.</div>
      </div>
    </div>
  </main>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CAPTURE MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3 class="modal-title">Capture Your Meal</h3>
    <p class="modal-sub">Take a photo and our AI will analyse the calories & macros</p>

    <input type="file" id="fileInput" accept="image/*" onchange="handlePhoto(event)">
    <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handlePhoto(event)">

    <!-- API Key field hidden - key is hardcoded -->
    <div id="apiKeyField" style="display:none;">
      <input type="password" id="inputApiKey" value="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">
    </div>

    <div class="photo-zone" id="photoZone">
      <div class="photo-zone-text">
        <div class="photo-zone-icon">ğŸ“·</div>
        <div class="photo-zone-label" style="margin-bottom:1rem;">Choose how to add your meal</div>
        <div style="display:flex;gap:0.75rem;justify-content:center;flex-wrap:wrap;">
          <button onclick="document.getElementById('cameraInput').click()" style="background:var(--amber);border:none;color:#000;font-family:'DM Sans',sans-serif;font-size:0.72rem;font-weight:500;letter-spacing:0.1em;text-transform:uppercase;padding:0.6rem 1.2rem;cursor:pointer;">ğŸ“¸ Camera</button>
          <button onclick="document.getElementById('fileInput').click()" style="background:none;border:1px solid var(--border);color:var(--white);font-family:'DM Sans',sans-serif;font-size:0.72rem;letter-spacing:0.1em;text-transform:uppercase;padding:0.6rem 1.2rem;cursor:pointer;">ğŸ–¼ Upload</button>
        </div>
      </div>
    </div>

    <div class="analyzing" id="analyzingState">
      <div class="spinner"></div>
      <div class="analyzing-text">Analysing your meal<span class="analyzing-dots"></span></div>
    </div>

    <div class="analysis-result" id="analysisResult">
      <div class="analysis-food-name" id="aFoodName"></div>
      <div class="analysis-macros">
        <div class="am-item">
          <div class="am-val" id="aCals">â€”</div>
          <div class="am-label">kcal</div>
        </div>
        <div class="am-item">
          <div class="am-val" id="aProtein">â€”</div>
          <div class="am-label">protein</div>
        </div>
        <div class="am-item">
          <div class="am-val" id="aCarbs">â€”</div>
          <div class="am-label">carbs</div>
        </div>
        <div class="am-item">
          <div class="am-val" id="aFat">â€”</div>
          <div class="am-label">fat</div>
        </div>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-save" id="btnSave" onclick="saveMeal()">Add to Log</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMPLE DB (localStorage)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DB = {
  getUsers() {
    return JSON.parse(localStorage.getItem('lumina_users') || '{}');
  },
  saveUsers(u) {
    localStorage.setItem('lumina_users', JSON.stringify(u));
  },
  register(username, password, name, goal) {
    const users = this.getUsers();
    if (users[username]) return { ok: false, msg: 'Username already taken' };
    // Simple hash (not cryptographic - fine for local PWA demo)
    users[username] = {
      name,
      pwHash: simpleHash(password),
      goal: parseInt(goal) || 2600,
      log: {}
    };
    this.saveUsers(users);
    return { ok: true };
  },
  login(username, password) {
    const users = this.getUsers();
    const u = users[username];
    if (!u) return { ok: false, msg: 'User not found' };
    if (u.pwHash !== simpleHash(password)) return { ok: false, msg: 'Incorrect password' };
    return { ok: true, user: { username, ...u } };
  },
  getUser(username) {
    const users = this.getUsers();
    return users[username];
  },
  saveDayLog(username, date, entries) {
    const users = this.getUsers();
    if (!users[username].log) users[username].log = {};
    users[username].log[date] = entries;
    this.saveUsers(users);
  },
  getDayLog(username, date) {
    const u = this.getUser(username);
    return (u && u.log && u.log[date]) ? u.log[date] : [];
  }
};

function simpleHash(str) {
  let h = 0;
  for (let i = 0; i < str.length; i++) {
    h = (Math.imul(31, h) + str.charCodeAt(i)) | 0;
  }
  return h.toString(36);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null;
let todayEntries = [];
let pendingMeal = null;
let currentTab = 'login';
const todayKey = () => new Date().toISOString().slice(0,10);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(id);
  el.classList.add('active');
  el.style.animation = 'none';
  requestAnimationFrame(() => { el.style.animation = ''; });
}

function showAuth() { showScreen('auth'); }

function switchTab(tab) {
  currentTab = tab;
  const isLogin = tab === 'login';
  document.getElementById('tabLogin').classList.toggle('active', isLogin);
  document.getElementById('tabRegister').classList.toggle('active', !isLogin);
  document.getElementById('nameField').style.display = isLogin ? 'none' : '';
  document.getElementById('goalField').style.display = isLogin ? 'none' : '';
  document.getElementById('authTitle').textContent = isLogin ? 'Welcome back' : 'Create account';
  document.getElementById('authSub').textContent = isLogin ? 'Sign in to continue your journey' : 'Join and start tracking today';
  document.getElementById('switchText').textContent = isLogin ? "Don't have an account?" : "Already have one?";
  document.getElementById('switchLink').textContent = isLogin ? 'Create one' : 'Sign in';
  document.getElementById('authError').classList.remove('show');
}

function handleAuth() {
  const username = document.getElementById('inputUser').value.trim();
  const password = document.getElementById('inputPass').value;
  const errorEl = document.getElementById('authError');

  if (!username || !password) {
    errorEl.textContent = 'Please fill in all fields';
    errorEl.classList.add('show');
    return;
  }

  if (currentTab === 'register') {
    const name = document.getElementById('inputName').value.trim() || username;
    const goal = document.getElementById('inputGoal').value;
    const res = DB.register(username, password, name, goal);
    if (!res.ok) { errorEl.textContent = res.msg; errorEl.classList.add('show'); return; }
    currentUser = { username, name, goal: parseInt(goal)||2600 };
  } else {
    const res = DB.login(username, password);
    if (!res.ok) { errorEl.textContent = res.msg; errorEl.classList.add('show'); return; }
    currentUser = res.user;
  }

  sessionStorage.setItem('lumina_session', JSON.stringify(currentUser));
  loadApp();
}

function logout() {
  sessionStorage.removeItem('lumina_session');
  currentUser = null;
  todayEntries = [];
  showScreen('landing');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadApp() {
  todayEntries = DB.getDayLog(currentUser.username, todayKey());
  showScreen('app');
  renderHeader();
  renderDashboard();
  renderLog();
  drawPie();
}

function renderHeader() {
  const name = currentUser.name || currentUser.username;
  const hour = new Date().getHours();
  const greet = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';
  document.getElementById('greetingText').textContent = `${greet}, ${name}`;
}

function renderDashboard() {
  const total = todayEntries.reduce((s, e) => s + e.calories, 0);
  const goal = currentUser.goal || 2600;
  const remaining = goal - total;

  document.getElementById('ringCalNum').textContent = total.toLocaleString();
  document.getElementById('statGoal').textContent = goal.toLocaleString();
  document.getElementById('statConsumed').textContent = total.toLocaleString();

  const remEl = document.getElementById('statRemaining');
  remEl.textContent = Math.max(0, remaining).toLocaleString();
  remEl.className = 'stat-val ' + (remaining < 0 ? 'red' : 'green');

  // Ring
  const circumference = 289;
  const pct = Math.min(total / goal, 1);
  const offset = circumference - pct * circumference;
  document.getElementById('ringFill').style.strokeDashoffset = offset;
  document.getElementById('ringFill').style.stroke = pct >= 1 ? '#EB5757' : 'var(--amber)';

  // Date
  const now = new Date();
  document.getElementById('dateLabel').textContent = now.toLocaleDateString('en-US', { weekday:'long', month:'long', day:'numeric' });
  document.getElementById('dateGoalLabel').textContent = `Goal: ${goal.toLocaleString()} kcal`;

  // Macros text
  const protein = todayEntries.reduce((s,e) => s + (e.protein||0), 0);
  const carbs   = todayEntries.reduce((s,e) => s + (e.carbs||0), 0);
  const fat     = todayEntries.reduce((s,e) => s + (e.fat||0), 0);
  document.getElementById('macroProtein').textContent = protein.toFixed(0) + 'g';
  document.getElementById('macroCarbs').textContent   = carbs.toFixed(0)   + 'g';
  document.getElementById('macroFat').textContent     = fat.toFixed(0)     + 'g';
}

function drawPie() {
  const canvas = document.getElementById('macroPie');
  const ctx = canvas.getContext('2d');
  const protein = todayEntries.reduce((s,e) => s + (e.protein||0), 0);
  const carbs   = todayEntries.reduce((s,e) => s + (e.carbs||0), 0);
  const fat     = todayEntries.reduce((s,e) => s + (e.fat||0), 0);

  const total = protein + carbs + fat;
  ctx.clearRect(0, 0, 120, 120);

  if (total === 0) {
    ctx.beginPath();
    ctx.arc(60, 60, 48, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(255,255,255,0.06)';
    ctx.lineWidth = 16;
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(60, 60, 48, 0, Math.PI * 2);
    ctx.fillStyle = 'transparent';
    ctx.fill();
    return;
  }

  const segments = [
    { val: protein, color: '#C9943A' },
    { val: carbs,   color: '#6FCF97' },
    { val: fat,     color: '#EB5757' }
  ];

  let start = -Math.PI / 2;
  segments.forEach(seg => {
    const angle = (seg.val / total) * Math.PI * 2;
    ctx.beginPath();
    ctx.moveTo(60, 60);
    ctx.arc(60, 60, 48, start, start + angle);
    ctx.closePath();
    ctx.fillStyle = seg.color;
    ctx.fill();
    start += angle;
  });

  // Donut hole
  ctx.beginPath();
  ctx.arc(60, 60, 30, 0, Math.PI * 2);
  ctx.fillStyle = '#161616';
  ctx.fill();
}

function renderLog() {
  const list = document.getElementById('logList');
  if (!todayEntries.length) {
    list.innerHTML = `<div class="empty-log"><div class="empty-icon">ğŸ½</div><div>No meals logged today.<br>Tap <em>Log a Meal</em> to get started.</div></div>`;
    return;
  }
  list.innerHTML = todayEntries.map((e, i) => `
    <div class="log-entry">
      <div class="log-entry-info">
        <div class="log-entry-name">${escHtml(e.name)}</div>
        <div class="log-entry-time">${e.time} Â· P:${e.protein||0}g C:${e.carbs||0}g F:${e.fat||0}g</div>
      </div>
      <div style="display:flex;align-items:center">
        <div class="log-entry-cals">${e.calories} kcal</div>
        <button class="btn-del" onclick="deleteEntry(${i})">âœ•</button>
      </div>
    </div>
  `).join('');
}

function deleteEntry(i) {
  todayEntries.splice(i, 1);
  DB.saveDayLog(currentUser.username, todayKey(), todayEntries);
  renderDashboard();
  renderLog();
  drawPie();
}

function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal() {
  pendingMeal = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('cameraInput').value = '';
  document.getElementById('photoZone').innerHTML = `
    <div class="photo-zone-text">
      <div class="photo-zone-icon">ğŸ“·</div>
      <div class="photo-zone-label" style="margin-bottom:1rem;">Choose how to add your meal</div>
      <div style="display:flex;gap:0.75rem;justify-content:center;flex-wrap:wrap;">
        <button onclick="document.getElementById('cameraInput').click()" style="background:var(--amber);border:none;color:#000;font-family:'DM Sans',sans-serif;font-size:0.72rem;font-weight:500;letter-spacing:0.1em;text-transform:uppercase;padding:0.6rem 1.2rem;cursor:pointer;">ğŸ“¸ Camera</button>
        <button onclick="document.getElementById('fileInput').click()" style="background:none;border:1px solid var(--border);color:var(--white);font-family:'DM Sans',sans-serif;font-size:0.72rem;letter-spacing:0.1em;text-transform:uppercase;padding:0.6rem 1.2rem;cursor:pointer;">ğŸ–¼ Upload</button>
      </div>
    </div>`;
  document.getElementById('analysisResult').classList.remove('show');
  document.getElementById('analyzingState').classList.remove('show');
  document.getElementById('btnSave').classList.remove('show');
  // Load saved API key
  const savedKey = localStorage.getItem('610_api_key') || '';
  document.getElementById('inputApiKey').value = savedKey;
  document.getElementById('modalOverlay').classList.add('open');
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
}

async function handlePhoto(evt) {
  const file = evt.target.files[0];
  if (!file) return;

  // Preview
  const url = URL.createObjectURL(file);
  const zone = document.getElementById('photoZone');
  zone.innerHTML = `<img src="${url}" alt="food">`;

  // Show analyzing
  document.getElementById('analysisResult').classList.remove('show');
  document.getElementById('btnSave').classList.remove('show');
  document.getElementById('analyzingState').classList.add('show');

  // Convert to base64
  const b64 = await toBase64(file);

  try {
    const result = await analyzeWithClaude(b64, file.type);
    pendingMeal = result;
    document.getElementById('analyzingState').classList.remove('show');
    showResult(result);
  } catch(err) {
    document.getElementById('analyzingState').classList.remove('show');
    const msg = err.message.includes('No API key') 
      ? 'Please enter your Anthropic API key above' 
      : 'Analysis failed: ' + err.message;
    showToast(msg);
    console.error(err);
  }
}

function toBase64(file) {
  return new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = () => res(r.result.split(',')[1]);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

async function analyzeWithClaude(base64, mediaType) {
  const apiKey = document.getElementById('inputApiKey').value.trim();
  if (!apiKey) throw new Error('No API key');
  // Save key locally for convenience
  localStorage.setItem('610_api_key', apiKey);

  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': apiKey,
      'anthropic-version': '2023-06-01',
      'anthropic-dangerous-direct-browser-access': 'true'
    },
    body: JSON.stringify({
      model: 'claude-opus-4-6',
      max_tokens: 512,
      messages: [{
        role: 'user',
        content: [
          {
            type: 'image',
            source: { type: 'base64', media_type: mediaType, data: base64 }
          },
          {
            type: 'text',
            text: `Analyse this food image and estimate nutritional values. Respond ONLY with a valid JSON object (no markdown, no code block), like:
{"name":"Food Name","calories":450,"protein":32,"carbs":40,"fat":12}
All numbers are integers. calories is total kcal. protein, carbs, fat are in grams. Be realistic with estimates.`
          }
        ]
      }]
    })
  });

  if (!response.ok) {
    const err = await response.json().catch(()=>({}));
    throw new Error(err.error?.message || 'API error ' + response.status);
  }
  const data = await response.json();
  const text = data.content.map(c => c.text || '').join('');
  return JSON.parse(text.replace(/```json|```/g,'').trim());
}

function showResult(r) {
  document.getElementById('aFoodName').textContent = r.name || 'Food';
  document.getElementById('aCals').textContent    = r.calories || 0;
  document.getElementById('aProtein').textContent = (r.protein || 0) + 'g';
  document.getElementById('aCarbs').textContent   = (r.carbs || 0) + 'g';
  document.getElementById('aFat').textContent     = (r.fat || 0) + 'g';
  document.getElementById('analysisResult').classList.add('show');
  document.getElementById('btnSave').classList.add('show');
}

function saveMeal() {
  if (!pendingMeal) return;
  const now = new Date();
  const entry = {
    ...pendingMeal,
    time: now.toLocaleTimeString('en-US', { hour:'numeric', minute:'2-digit' })
  };
  todayEntries.push(entry);
  DB.saveDayLog(currentUser.username, todayKey(), todayEntries);
  closeModal();
  renderDashboard();
  renderLog();
  drawPie();
  showToast(`${entry.name} added â€” ${entry.calories} kcal`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-LOGIN FROM SESSION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded', () => {
  const session = sessionStorage.getItem('lumina_session');
  if (session) {
    try {
      currentUser = JSON.parse(session);
      // refresh from DB (in case goal changed)
      const u = DB.getUser(currentUser.username);
      if (u) { currentUser = { username: currentUser.username, ...u }; loadApp(); return; }
    } catch(e) {}
  }
  showScreen('landing');
});

// Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(()=>{});
}

// Close modal on backdrop click
document.getElementById('modalOverlay').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
</script>
</body>
</html>
